    ORG 00H
    SJMP INIT
    ORG 50H
LED_DISPLAY MACRO DATA, MA
    MOV A, DATA
    ORL A, #MA
    MOV P1, A
    ACALL DELAY
    ENDM
LED1 REG 30H
LED2 REG 31H
LED3 REG 32H
LED4 REG 33H
KEY REG 34H
COL REG R1
KEY_DELAY1 REG R2
KEY_DELAY2 REG R3
NUM REG R4
COL_TAB REG R5
INIT:
    MOV KEY, #00H
    MOV COL, #0D0H
    MOV NUM, #00H
    MOV COL_TAB, #00H
    MOV LED1, #00H
    MOV LED2, #00H
    MOV LED3, #00H
    MOV LED4, #00H
MAIN:
    ACALL READ_KEY
    ;ACALL LED
    JMP MAIN
READ_KEY:
    MOV DPTR, #COL_TABLE
    MOV A, COL_TAB
    MOVC A, @A+DPTR
    INC COL_TAB
    ORL A, #0FH
    MOV P2, A
    MOV KEY_DELAY1, #01FH
RE_READ:
    MOV KEY_DELAY2, #0FFH
RE_READ1:
    MOV KEY, P2
    DJNZ KEY_DELAY2, RE_READ1
    DJNZ KEY_DELAY1, RE_READ
    MOV NUM, #00H
    MOV A, KEY
    ANL A, #0FH
    CJNE A, #0FH, SCAN
    MOV NUM, #0FFH
    ACALL LED
    CJNE COL_TAB, #03H, READ_KEY
    MOV COL_TAB, #00H
    RET
SCAN:
    MOV DPTR, #KEY_TABLE
    MOV A, NUM
    MOVC A, @A+DPTR
    INC NUM
    CJNE A, KEY, SCAN
    DEC NUM
    MOV COL_TAB, #00H
    ACALL LED
    RET
LED:
    CJNE NUM, #0FFH, LED_1
    JMP LED_2
LED_1:
    MOV LED1, LED2
    MOV LED2, LED3
    MOV LED3, LED4
    MOV LED4, NUM
LED_2:
    LED_DISPLAY LED1, 0E0H
    LED_DISPLAY LED2, 0D0H
    LED_DISPLAY LED3, 0B0H
    ;LED_DISPLAY LED4, 70H
    MOV A, LED4
    ORL A, #70H
    MOV P1, A
    RET
DELAY:
    MOV KEY_DELAY1, #02H
DELAY1:
    MOV KEY_DELAY2, #0FFH
    DJNZ KEY_DELAY2, $
    DJNZ KEY_DELAY1, DELAY1
    RET
    ORG 0500H
KEY_TABLE:
    DB 01111110B, 10111110B, 11011110B, 01111101B
    DB 10111101B, 11011101B, 01111011B, 10111011B
    DB 11011011B, 01110111B
COL_TABLE:
    DB 0D0H, 0B0H, 070H
    END



