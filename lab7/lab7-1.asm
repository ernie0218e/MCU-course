    ORG 00H
    JMP INIT
    ORG 03H
    JMP EXISR
    ORG 50H
COUNT REG R0
ROW REG R1
RANGE REG R2
INIT:
    SETB IT0    ;falling edge trigger
    MOV IE, #10000001B  ;enable external interrupt
    MOV TMOD, #01H  ;enable timer0
    CALL SET_TIMER
    MOV DPTR, #TABLE
    MOV COUNT, #0
    MOV ROW, #59
    MOV RANGE, #20
    JMP $
EXISR:
    CLR IE0
    INC COUNT
    CJNE COUNT, #3, NCHANGE ;if count != 3, don't change the output
    MOV COUNT, #0
    INC ROW
    INC ROW
    INC ROW
    CJNE ROW, #248 ,NOT_RESET
    MOV ROW, #59
NOT_RESET:
    CALL OUTPUT
    RETI
NCHANGE:
    CALL OUTPUT
    RETI

OUTPUT:
    MOV A, ROW
    MOV R3, A
OUTPUT1:
    MOV A, R3
    MOVC A, @A+DPTR
    MOV P0, A
    DEC R3
    MOV A, R3
    MOVC A, @A+DPTR
    MOV P2, A
    DEC R3
    MOV A, R3
    MOVC A, @A+DPTR
    MOV P1, A
    DEC R3
    ACALL SET_TIMER
    SETB TR0
    JNB TF0, $
    CLR TR0
    CLR TF0
    DJNZ RANGE, OUTPUT1
    MOV P0, #0FFH
    MOV P1, #0FFH
    MOV P2, #0FFH
    MOV RANGE, #20
    RET
SET_TIMER:
    MOV TL0, #<-800    ;set timer to count 1ms
    MOV TH0, #>-800
    RET
TABLE:
    DB 11111111B, 11111111B, 11111111B
    DB 11000000B, 00000000B, 00000011B
    DB 11000000B, 00000000B, 00000011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11110000B, 00000000B, 00001111B
    DB 11100000B, 00000000B, 00000111B
    DB 11000111B, 11111111B, 11100011B
    DB 11001111B, 11111111B, 11110011B
    DB 11001111B, 11111111B, 11110011B
    DB 11001111B, 11111111B, 11110011B
    DB 11001111B, 11111111B, 11110011B
    DB 11001111B, 11111111B, 11110011B
    DB 11001111B, 11111111B, 11110011B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11000000B, 00000000B, 00000011B
    DB 11000000B, 00000000B, 00000011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11001111B, 11110011B, 11110011B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11110011B
    DB 11111111B, 11111111B, 11110011B
    DB 11111111B, 11111111B, 11110011B
    DB 11111111B, 11111111B, 11110011B
    DB 11111111B, 11111111B, 11110011B
    DB 11111111B, 11111111B, 11110011B
    DB 11000000B, 00000000B, 00110011B
    DB 11000000B, 00000000B, 00000011B
    DB 11111111B, 11111111B, 11000011B
    DB 11111111B, 11111111B, 11111011B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111110B, 00001111B, 11111111B
    DB 11111110B, 00000011B, 11111111B
    DB 11111110B, 01100000B, 01111111B
    DB 11111110B, 01111000B, 00001111B
    DB 11111110B, 01111111B, 00000111B
    DB 11111110B, 01111111B, 11100111B
    DB 11000000B, 00000000B, 00000011B
    DB 11000000B, 00000000B, 00000011B
    DB 11111110B, 01111111B, 11111111B
    DB 11111110B, 01111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111110B, 00000111B
    DB 11111111B, 11111100B, 00000011B
    DB 11111111B, 11111100B, 11110011B
    DB 11111111B, 11111100B, 11110011B
    DB 11001111B, 11111100B, 11110011B
    DB 11000000B, 11111100B, 11110011B
    DB 11110000B, 00001100B, 11110011B
    DB 11111111B, 11000000B, 00000011B
    DB 11111111B, 11111100B, 00000111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    DB 11111111B, 11111111B, 11111111B
    END
